stages:
  - server
  - frontend

backendtest:
  stage: server
  script:
    - cd server
    - pip3 install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
    - python3 -m coverage run --source="." manage.py test --noinput
    - python3 -m coverage report
  tags:
    - shared

backendlint:
  stage: server
  script:
    - cd server
    - pip3 install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
    - pylint --rcfile=.pylintrc ./**/*.py || exit $((35 & $?))
  allow_failure: false
  tags:
    - shared

frontendtest:
  stage: frontend
  script:
    - cd frontend
    - npm install --registry https://registry.npm.taobao.org
    - npm run test
  allow_failure: false
  tags:
    - shared

frontendlint:
  stage: frontend
  script:
    - cd frontend
    - npm install --registry https://registry.npm.taobao.org
    - npm run eslint
    - npm run stylelint
  allow_failure: false
  tags:
    - shared
